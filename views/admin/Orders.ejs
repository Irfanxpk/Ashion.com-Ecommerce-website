 <%- include("../partials/adminHeader") %>


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
                <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>
                <form class="d-none d-md-flex ms-4">
                    <!-- <input class="form-control bg-dark border-0" type="search" placeholder="Search"> -->
                </form>
                <div class="navbar-nav align-items-center ms-auto">
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-envelope me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Message</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all message</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notificatin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Profile updated</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">New user added</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Password changed</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all notifications</a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="rounded-circle me-lg-2" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">John Doe</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item">Settings</a>
                            <a href="#" class="dropdown-item">Log Out</a>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Navbar End -->

            <div class="container-fluid pt-4 px-4">
                <div class="row vh-100 bg-secondary rounded mx-0 pt-3">




    <!-- views/orders.ejs -->

<!-- Assuming you have a layout file, include it here -->

<!-- views/orders.ejs -->

<!-- Assuming you have a layout file, include it here -->

<!-- views/orders.ejs -->

<!-- Assuming you have a layout file, include it here -->

<div class="container mt-4" >
  <h2>Order Listing</h2>

  <table class="table" id="orderTable">
    <thead>
      <tr>
        <th scope="col">Image</th>
        <th scope="col">Address and Date </th>
        <th scope="col">Total Amount</th>
        <th scope="col">Status</th>
        <th scope="col">Change Status</th>
        <!-- Add more columns as needed for your order table -->
      </tr>
    </thead>
    <tbody>
      <% orders.forEach(order => { %>
        <tr>
          <td>
            <!-- Display image if available -->
            <% if (order.items.length > 0 && order.items[0].img) { %>
             <a href="/admin/<%=order._id%>"> <img src="/uploads/product_resized/<%= order.items[0].img %>" alt="Product Image" style="max-width: 50px; max-height: 50px;"></a>
            <% } else { %>
              No Image
            <% } %>
          </td>
        <% const formattedDate=new Date(order.purchaseDate).toLocaleString(); %>
          <td><%= formattedDate %>  
        
            <address>
                <strong>
                    <%= order.addresses.name %>
                </strong><br />
                <%= order.addresses.address %><br />
                    <%= order.addresses.city %>, <%= order.addresses.state %>
                            <%= order.addresses.zip %><br />
                                <abbr title="Phone">Phone</abbr>
                                <%= order.addresses.phone %>
            </address>
        </td>
          <td>â‚¹<%= order.totalAmount %>.00</td>
          <td><%= order.status %></td>
          <td>
            <!-- Replace the form with a select input and use JavaScript to handle the change event -->
            <% if (order.status != "Cancelled") { %>
            <select
              name="newStatus"
              class="form-select"
              onchange="changeOrderStatus('<%= order._id %>')"
              value="<%= order.status %>"
                                                         
            >
               <option value="Placed" <%= order.status == "Placed" ? 'selected' : '' %>>Placed</option>
                                        <!-- <option value="Processing" <%= order.status == "Processing" ? 'selected' : '' %>>Processing</option> -->
                                        <option value="Shipped" <%= order.status == "Shipped" ? 'selected' : '' %>>Shipped</option>
                                        <option value="Out for delivery" <%=order.status == "Out for delivery" ? 'selected' : '' %>>Out for delevery</option>
                                        <option value="Delivered" <%= order.status == "Delivered" ? 'selected' : '' %>>Delivered</option>
                                        <option value="Cancelled" <%= order.status == "Cancelled" ? 'selected' : '' %>>Cancell</option>
                                        <!-- <option value="Returned" <%= order.status == "Returned" ? 'selected' : '' %>>Returned</option> -->
            </select>
            <% }else { %>

                <select name="newStatus" class="form-select" id="" >
                    <option value="" onclick="cancelled()">Cancelled</option>
                </select>
                <% } %>
          </td>
          <!-- Add more columns as needed for your order table -->
        </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<script>
  function cancelled() {
    console.log("hello iam here at cancell error")
    Swal.fire({
          icon: "error",
          title: "Oops...",
          text: "you can't cancel the order which is already cancelled!",
      });
  }
</script>

<script>
  // Function to handle the change in order status
  function changeOrderStatus(orderId) {
      console.log("in the fetch")
      const newStatus = event.target.value
    console.log(newStatus)
    fetch(`/admin/changeOrderStatus/${orderId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ newStatus }),
    })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        const orderTable = document.getElementById('orderTable');
         location.reload();
        // Optionally, update the UI or show a notification upon success
      })
      .catch((error) => {
        console.error('Error:', error);
        // Optionally, handle the error or show a notification
      });
  }
</script>
<!-- End of the file -->


<!-- End of the file -->

<!-- End of the file -->



                </div>
            </div>
            <!-- Blank End -->

         
           
        </div>
        <!-- Content End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>
  

    <script src="https://kit.fontawesome.com/744b7c765b.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/admin/lib/chart/chart.min.js"></script>
    <script src="/admin/lib/easing/easing.min.js"></script>
    <script src="/admin/lib/waypoints/waypoints.min.js"></script>
    <script src="/admin/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/admin/lib/tempusdominus/js/moment.min.js"></script>
    <script src="/admin/lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="/admin/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="/admin/js/image-preview.js"></script>
    <!-- Template Javascript -->
    <script src="/admin/js/main.js"></script>

   


</body>

</html>